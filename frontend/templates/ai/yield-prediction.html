{% extends "base.html" %}

{% block title %}Yield Prediction - Agriculture Insights Platform{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="bg-gradient-to-r from-earth-600 to-yellow-600 text-white py-12">
    <div class="container mx-auto px-4">
        <div class="text-center">
            <h1 class="text-4xl font-bold mb-4">AI Yield Prediction</h1>
            <p class="text-xl text-earth-100">Machine learning-powered crop yield forecasting based on multiple data sources</p>
        </div>
    </div>
</div>

<!-- Main Content -->
<div class="py-8">
    <div class="container mx-auto px-4">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Input Form -->
            <div class="lg:col-span-1">
                <div class="card sticky-top">
                    <h2 class="text-xl font-bold text-gray-800 mb-6">Prediction Parameters</h2>
                    
                    <form id="yieldPredictionForm" class="space-y-6">
                        <!-- Field Information -->
                        <div>
                            <h3 class="font-semibold text-gray-800 mb-3">Field Information</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Field Name *</label>
                                    <select class="input-field w-full" required>
                                        <option value="">Select field...</option>
                                        <option value="north-field">North Field (120 acres)</option>
                                        <option value="south-field">South Field (85 acres)</option>
                                        <option value="east-field">East Field (95 acres)</option>
                                        <option value="west-field">West Field (140 acres)</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Crop Type *</label>
                                    <select class="input-field w-full" required>
                                        <option value="">Select crop...</option>
                                        <option value="corn">Corn</option>
                                        <option value="soybeans">Soybeans</option>
                                        <option value="wheat">Wheat</option>
                                        <option value="cotton">Cotton</option>
                                        <option value="rice">Rice</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Field Size (acres) *</label>
                                    <input type="number" class="input-field w-full" placeholder="Enter field size" required>
                                </div>
                            </div>
                        </div>

                        <!-- Planting Information -->
                        <div>
                            <h3 class="font-semibold text-gray-800 mb-3">Planting Details</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Planting Date</label>
                                    <input type="date" class="input-field w-full">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Variety/Hybrid</label>
                                    <input type="text" class="input-field w-full" placeholder="e.g., Pioneer P1234">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Seeding Rate</label>
                                    <div class="flex space-x-2">
                                        <input type="number" class="input-field flex-1" placeholder="Rate">
                                        <select class="input-field w-24">
                                            <option>lbs/ac</option>
                                            <option>seeds/ac</option>
                                            <option>kg/ha</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Environmental Data -->
                        <div>
                            <h3 class="font-semibold text-gray-800 mb-3">Current Conditions</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Current NDVI</label>
                                    <div class="flex items-center space-x-2">
                                        <input type="range" min="0" max="1" step="0.01" value="0.75" class="flex-1" id="ndviSlider">
                                        <span id="ndviValue" class="text-sm font-medium w-12">0.75</span>
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Soil Moisture (%)</label>
                                    <div class="flex items-center space-x-2">
                                        <input type="range" min="0" max="100" value="35" class="flex-1" id="moistureSlider">
                                        <span id="moistureValue" class="text-sm font-medium w-12">35%</span>
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Growth Stage</label>
                                    <select class="input-field w-full">
                                        <option>Emergence</option>
                                        <option>Vegetative</option>
                                        <option>Reproductive</option>
                                        <option>Grain Fill</option>
                                        <option>Maturity</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Prediction Options -->
                        <div>
                            <h3 class="font-semibold text-gray-800 mb-3">Prediction Settings</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Model Type</label>
                                    <div class="space-y-2">
                                        <label class="flex items-center">
                                            <input type="radio" name="modelType" value="standard" checked class="mr-2">
                                            <span class="text-sm">Standard Model (Fast)</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="modelType" value="advanced" class="mr-2">
                                            <span class="text-sm">Advanced Model (Detailed)</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="modelType" value="ensemble" class="mr-2">
                                            <span class="text-sm">Ensemble Model (Most Accurate)</span>
                                        </label>
                                    </div>
                                </div>

                                <div>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="mr-2">
                                        <span class="text-sm">Include weather forecast</span>
                                    </label>
                                </div>

                                <div>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="mr-2">
                                        <span class="text-sm">Generate confidence intervals</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="btn-primary w-full">
                            <i class="fas fa-brain mr-2"></i>
                            Generate Prediction
                        </button>
                    </form>
                </div>
            </div>

            <!-- Results Area -->
            <div class="lg:col-span-2 space-y-8">
                <!-- Prediction Results -->
                <div class="card" id="predictionResults" style="display: none;">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold text-gray-800">Yield Prediction Results</h2>
                        <div class="text-sm text-gray-600">
                            Generated: <span id="predictionTime"></span>
                        </div>
                    </div>

                    <!-- Main Prediction -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="text-center p-6 bg-green-50 rounded-xl">
                            <div class="text-4xl font-bold text-green-600 mb-2" id="predictedYield">165</div>
                            <div class="text-lg text-gray-800 mb-1">bu/acre</div>
                            <div class="text-sm text-gray-600">Predicted Yield</div>
                        </div>

                        <div class="text-center p-6 bg-blue-50 rounded-xl">
                            <div class="text-4xl font-bold text-blue-600 mb-2" id="confidenceLevel">94</div>
                            <div class="text-lg text-gray-800 mb-1">%</div>
                            <div class="text-sm text-gray-600">Confidence Level</div>
                        </div>

                        <div class="text-center p-6 bg-purple-50 rounded-xl">
                            <div class="text-4xl font-bold text-purple-600 mb-2" id="yieldChange">+12</div>
                            <div class="text-lg text-gray-800 mb-1">%</div>
                            <div class="text-sm text-gray-600">vs Last Year</div>
                        </div>
                    </div>

                    <!-- Confidence Interval -->
                    <div class="mb-8">
                        <h3 class="font-semibold text-gray-800 mb-4">Yield Range (95% Confidence)</h3>
                        <div class="bg-gray-100 rounded-lg p-6">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm text-gray-600">Lower Bound</span>
                                <span class="text-sm text-gray-600">Prediction</span>
                                <span class="text-sm text-gray-600">Upper Bound</span>
                            </div>
                            <div class="relative bg-gray-200 rounded-full h-4 mb-2">
                                <div class="absolute bg-green-500 rounded-full h-4" style="left: 20%; width: 60%;"></div>
                                <div class="absolute bg-green-700 rounded-full h-4 w-1" style="left: 50%;"></div>
                            </div>
                            <div class="flex items-center justify-between text-sm font-medium">
                                <span>145 bu/acre</span>
                                <span class="text-green-600">165 bu/acre</span>
                                <span>185 bu/acre</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Factors Analysis -->
                <div class="card" id="factorsAnalysis" style="display: none;">
                    <h2 class="text-xl font-bold text-gray-800 mb-6">Key Factors Influencing Yield</h2>
                    
                    <div class="space-y-4">
                        <div class="flex items-center p-4 bg-green-50 rounded-lg">
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mr-4">
                                <i class="fas fa-leaf text-green-600"></i>
                            </div>
                            <div class="flex-1">
                                <div class="font-semibold text-gray-800">Vegetation Health (NDVI)</div>
                                <div class="text-sm text-gray-600">High vegetation index indicates excellent crop health</div>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold text-green-600">+15%</div>
                                <div class="text-sm text-gray-600">Impact</div>
                            </div>
                        </div>

                        <div class="flex items-center p-4 bg-blue-50 rounded-lg">
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4">
                                <i class="fas fa-tint text-blue-600"></i>
                            </div>
                            <div class="flex-1">
                                <div class="font-semibold text-gray-800">Soil Moisture</div>
                                <div class="text-sm text-gray-600">Adequate moisture levels support healthy growth</div>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold text-blue-600">+8%</div>
                                <div class="text-sm text-gray-600">Impact</div>
                            </div>
                        </div>

                        <div class="flex items-center p-4 bg-yellow-50 rounded-lg">
                            <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center mr-4">
                                <i class="fas fa-cloud-sun text-yellow-600"></i>
                            </div>
                            <div class="flex-1">
                                <div class="font-semibold text-gray-800">Weather Conditions</div>
                                <div class="text-sm text-gray-600">Favorable temperature and precipitation patterns</div>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold text-yellow-600">+5%</div>
                                <div class="text-sm text-gray-600">Impact</div>
                            </div>
                        </div>

                        <div class="flex items-center p-4 bg-purple-50 rounded-lg">
                            <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mr-4">
                                <i class="fas fa-seedling text-purple-600"></i>
                            </div>
                            <div class="flex-1">
                                <div class="font-semibold text-gray-800">Growth Stage</div>
                                <div class="text-sm text-gray-600">Current development stage aligns with optimal timing</div>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold text-purple-600">+3%</div>
                                <div class="text-sm text-gray-600">Impact</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Historical Comparison -->
                <div class="card" id="historicalComparison" style="display: none;">
                    <h2 class="text-xl font-bold text-gray-800 mb-6">Historical Yield Comparison</h2>
                    
                    <div class="bg-gray-100 rounded-lg h-64 flex items-center justify-center mb-4">
                        <canvas id="yieldComparisonChart" width="600" height="200"></canvas>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-sm">
                        <div class="text-center">
                            <div class="font-medium text-gray-800">5-Year Average</div>
                            <div class="text-blue-600 font-bold">148 bu/acre</div>
                        </div>
                        <div class="text-center">
                            <div class="font-medium text-gray-800">Best Year</div>
                            <div class="text-green-600 font-bold">172 bu/acre (2022)</div>
                        </div>
                        <div class="text-center">
                            <div class="font-medium text-gray-800">Worst Year</div>
                            <div class="text-red-600 font-bold">125 bu/acre (2020)</div>
                        </div>
                        <div class="text-center">
                            <div class="font-medium text-gray-800">Trend</div>
                            <div class="text-purple-600 font-bold">+2.3% annually</div>
                        </div>
                    </div>
                </div>

                <!-- Recommendations -->
                <div class="card" id="recommendations" style="display: none;">
                    <h2 class="text-xl font-bold text-gray-800 mb-6">Optimization Recommendations</h2>
                    
                    <div class="space-y-4">
                        <div class="flex items-start p-4 bg-green-50 border-l-4 border-green-400 rounded-lg">
                            <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0 mr-3">
                                <i class="fas fa-check-circle text-green-600"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-800 mb-1">Continue Current Management</h3>
                                <p class="text-sm text-gray-600">
                                    Your current practices are yielding excellent results. Maintain fertilization and irrigation schedules.
                                </p>
                            </div>
                        </div>

                        <div class="flex items-start p-4 bg-blue-50 border-l-4 border-blue-400 rounded-lg">
                            <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0 mr-3">
                                <i class="fas fa-tint text-blue-600"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-800 mb-1">Monitor Soil Moisture</h3>
                                <p class="text-sm text-gray-600">
                                    Consider supplemental irrigation during grain fill stage to maximize yield potential.
                                </p>
                            </div>
                        </div>

                        <div class="flex items-start p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded-lg">
                            <div class="w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center flex-shrink-0 mr-3">
                                <i class="fas fa-flask text-yellow-600"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-800 mb-1">Nutrient Management</h3>
                                <p class="text-sm text-gray-600">
                                    Late-season nitrogen application could boost yield by an additional 3-5 bushels per acre.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Default State -->
                <div class="card" id="defaultState">
                    <div class="text-center py-16">
                        <i class="fas fa-chart-bar text-6xl text-gray-300 mb-4"></i>
                        <h2 class="text-2xl font-bold text-gray-600 mb-2">Ready for Yield Prediction</h2>
                        <p class="text-gray-500 mb-6">Fill out the form on the left to generate AI-powered yield predictions for your field.</p>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 max-w-2xl mx-auto">
                            <div class="text-center p-4">
                                <i class="fas fa-brain text-2xl text-blue-600 mb-2"></i>
                                <div class="font-medium text-gray-800">AI-Powered</div>
                                <div class="text-sm text-gray-600">Machine learning models</div>
                            </div>
                            <div class="text-center p-4">
                                <i class="fas fa-satellite text-2xl text-green-600 mb-2"></i>
                                <div class="font-medium text-gray-800">Satellite Data</div>
                                <div class="text-sm text-gray-600">Real-time monitoring</div>
                            </div>
                            <div class="text-center p-4">
                                <i class="fas fa-chart-line text-2xl text-purple-600 mb-2"></i>
                                <div class="font-medium text-gray-800">Historical Analysis</div>
                                <div class="text-sm text-gray-600">Multi-year trends</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Chart.js Script -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Slider updates
    const ndviSlider = document.getElementById('ndviSlider');
    const ndviValue = document.getElementById('ndviValue');
    const moistureSlider = document.getElementById('moistureSlider');
    const moistureValue = document.getElementById('moistureValue');

    ndviSlider.addEventListener('input', function() {
        ndviValue.textContent = this.value;
    });

    moistureSlider.addEventListener('input', function() {
        moistureValue.textContent = this.value + '%';
    });

    // Form submission
    document.getElementById('yieldPredictionForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Hide default state and show loading
        document.getElementById('defaultState').style.display = 'none';
        
        // Show loading state
        const submitBtn = this.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Analyzing...';
        submitBtn.disabled = true;
        
        // Simulate prediction generation
        setTimeout(() => {
            // Show results
            document.getElementById('predictionResults').style.display = 'block';
            document.getElementById('factorsAnalysis').style.display = 'block';
            document.getElementById('historicalComparison').style.display = 'block';
            document.getElementById('recommendations').style.display = 'block';
            
            // Update prediction time
            document.getElementById('predictionTime').textContent = new Date().toLocaleString();
            
            // Reset button
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
            
            // Initialize chart
            initializeYieldChart();
        }, 3000);
    });

    function initializeYieldChart() {
        const ctx = document.getElementById('yieldComparisonChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['2019', '2020', '2021', '2022', '2023', '2024 (Predicted)'],
                datasets: [{
                    label: 'Yield (bu/acre)',
                    data: [142, 125, 156, 172, 148, 165],
                    backgroundColor: [
                        '#6B7280', '#EF4444', '#6B7280', '#10B981', '#6B7280', '#3B82F6'
                    ],
                    borderColor: [
                        '#4B5563', '#DC2626', '#4B5563', '#059669', '#4B5563', '#2563EB'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: false,
                        min: 100,
                        max: 180
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.parsed.y + ' bu/acre';
                            }
                        }
                    }
                }
            }
        });
    }
});
</script>
{% endblock %}